function collectionSite(){$(".collection").on("click",function(){$(".cover").show()})}function checkUserStatus(){var e=localStorage.getItem("username");if(null==e||"null"==e){t="欢迎来到慕课网&nbsp;";t+='<a class="loginLink" href="login.html">[登录]</a>&nbsp;',t+='<a class="registerLink" href="register.html">[免费注册]</a>',$(".topbar .rightArea").html(t)}else{var t="欢迎";t+='<a class="showUsername" href="javascript:;">'+e+"</a>",t+="来到慕课网&nbsp;",t+='<a class="exit" href="javascript:;">[退出]</a>',$(".topbar .rightArea").html(t),$(".topbar .exit").on("click",function(){var e="欢迎来到慕课网&nbsp;";e+='<a class="loginLink" href="login.html">[登录]</a>&nbsp;',e+='<a class="registerLink" href="register.html">[免费注册]</a>',$(".topbar .rightArea").html(e),localStorage.setItem("username",null)})}}function getSearchList(){$(".search-box").mouseleave(function(){$(".search-box ul").remove()}),$(".search-text").keyup(function(){$(".search-box ul").remove();var e={code:"utf-8",q:$(".search-text").val(),_ksTS:"1490839958568_2749",jsonpCallback:"jsonp2750",area:"b2c",k:1,bucketid:7,src:"tmall_pc"};getData(config.taobaoUrl,"get","jsonp",e,getSearchResult)})}function getSearchResult(e){var t=e.result;showSearchList(t,$(".search-text").val()),selectResult(t)}function showSearchList(e,t){if(!(e.length<=0)){var s="<ul class='result-list'>";$.each(e,function(e,a){if(s+="<li class='clearfix' value="+e+">",-1==(e=a[0].indexOf(t)))s+="<p class='proName'>"+a[0]+"</p>";else if(0==e)s+="<p class='proName'><em>"+t+"</em>"+a[0].substring(t.length)+"</p>";else if(e==a[0].length-t.length)s+="<p class='proName'>"+a[0].substring(0,a[0].length-t.length)+"<em>"+t+"</em></p>";else{var i=a[0].split(t);s+="<p class='proName'>";for(var o=0;o<i.length-1;o++)s+=i[o],s+="<em>"+t+"</em>";s+=i[i.length-1],s+="</p>"}s+="<p class='resultNum'>约"+a[1]+"个商品</p>",s+="</li>"}),s+="</ul>",$(".search-box").append(s)}}function selectResult(e){var t=$(".result-list li");$.each(t,function(t,s){s.onclick=function(){var t=$(this).attr("value");$(".search-box ul").remove(),$(".search-text").val(e[t][0])}})}function searchData(){$(".search-btn").click(function(){var e=$(".search-text ").val();window.location=config.baiduUrl+"?wd="+e})}function changeNav(){var e=$(".nav li");$.each(e,function(e,t){$(t).click(function(){$(this).addClass("active").siblings("li").removeClass("active"),localStorage.setItem("active",$(this).index())})})}function gotoTop(){$("goTop");var e=0,t=0,s=null;$(window).scroll(function(){$(document).scrollTop()>0?$("#goTop").show():$("#goTop").hide(),e=$(document).scrollTop()}),$("#goTop").on("click",function(){clearInterval(s),t=0,s=setInterval(function(){e+=(t-e)/10,window.scrollTo(0,e),e==t&&clearInterval(s)},10)})}function setProductNum(){var e=parseInt(localStorage.getItem("productNum"));isNaN(e)&&(e=1),$(".shopCar .shopNum").text(e)}function hideDialog(){$(".hide-dialog").on("click",function(){$(".cover").hide()})}function setBanner(){function e(){a=++a>s.length-1?0:a,t.removeClass("current"),t.eq(a).addClass("current"),s.removeClass("active");var e=s.eq(a);e.addClass("active"),e.css("opacity","0"),animate(e[0],{opacity:100},40)}var t=$(".circle-list li"),s=$(".banner-list li"),a=0,i=null;t.on("click",function(){if($(this).index()!=a){a=$(this).index(),$(this).addClass("current").siblings("li").removeClass("current"),s.removeClass("active");var e=s.eq(a);e.addClass("active"),e.css("opacity","0"),animate(e[0],{opacity:100},40)}}),i=setInterval(e,3e3),$(".banner-list").mouseenter(function(){clearInterval(i)}),$(".banner-list").mouseleave(function(){i=setInterval(e,3e3)})}function getData(e,t,s,a,i){$.ajax({url:e,type:t,dataType:s,data:a,success:i})}function setAddress(e,t,s,a){$("#"+e+" .select-options").children("li").remove(),$.each(t,function(t,s){var a=$("<li></li>").html(s.name).attr("value",s.code);$("#"+e+" .select-options").append(a)});var i=$("#"+e+" .select-options").children("li:eq(0)").attr("value"),o=$("#"+e+" .select-options").children("li:eq(0)")[0].innerHTML;if($("#"+e+" .select-name").html(o),null!=s){var n={citycode:i,flag:s};getData(config.addressUrl,"get","jsonp",n,a)}}function changeAddress(e,t,s){$("#"+e).mouseenter(function(){$("#"+e+" .select-options").show()}),$("#"+e).mouseleave(function(){$("#"+e+"  .select-options").hide()}),$("#"+e+" .select-options li").click(function(){$("#"+e+" .select-name").html($(this)[0].innerHTML),$("#"+e+" .select-options").hide();$(this).attr("value");if(null!=t){var a={citycode:$(this).attr("value"),flag:t};getData(config.addressUrl,"get","jsonp",a,s)}})}function setOverflowY(e){var t=$("#"+e+" .select-options"),s=$("#"+e+" .select-options li");t.height()<122?(t.css("overflow-y","inherit"),s.css("width","100%")):(t.css("overflow-y","scroll"),s.css("width","93px"))}function createPage(e,t,s,a,i){var o=Math.ceil(e/t);$(".appra-num").html(e);var n=(s+t)/t,r="<div class='rate-page'>";r+=1==n?"<span class='page-prev'>&lt;&lt;上一页</span>":"<a href='javascript:;' class='page-prev'>&lt;&lt;上一页</a>";for(l=1;l<=o;l++)r+=l==n?"<span>"+l+"</span>":"<a href='javascript:;'>"+l+"</a>";r+=n==o?"<span class='page-next'>下一页&gt;&gt;</span>":"<a href='javascript:;' class='page-next'>下一页&gt;&gt;</a>",r+="</div>",$("."+a+" .rate-page").remove(),$("."+a).append($(r)),$(".page-prev").click(function(){if("A"==this.nodeName){var e={flag:2,startIndex:s=t*--n-t,amount:t};getData(config.productUrl,"get","jsonp",e,i)}}),$(".page-next").click(function(){if("A"==this.nodeName){var e={flag:2,startIndex:s=t*++n-t,amount:t};getData(config.productUrl,"get","jsonp",e,i),e={flag:1},getData(config.productUrl,"get","jsonp",e,createPage)}});for(var c=$(".rate-page")[0].children,l=1;l<c.length-1;l++)$(c[l]).click(function(){if("A"==this.nodeName){n=this.innerHTML;var e={flag:2,startIndex:s=t*n-t,amount:t};getData(config.productUrl,"get","jsonp",e,i)}})}function resetData(e){var t=$("."+e).val();return t=Tools.removeAll(t),$("."+e).val(t),t}function showCheckResult(e,t,s,a){0==s?($("."+e+" .notice-info").css("display","inline-block"),t.length>0&&$("."+e+" ."+t).css("border-color","#e22"),$("."+e+" .notice-content").css("color","#e22"),$("."+e+" .notice-icon").css({"background-position":"-17px -100px"})):1==s&&($("."+e+" .notice-info").css("display","inline-block"),$("."+e+" .notice-content").css("color","#3D882D"),$("."+e+" .notice-icon").css({"background-position":"0px -117px"})),$("."+e+" .notice-content")[0].innerHTML=a}function hideCheckResult(e,t){$("."+e+" .notice-info").css("display","none"),t.length>0&&$("."+e+" ."+t).css("border-color","#C2C2C2")}function hideNotice(e){$("."+e+" .tips").hide()}function showNotice(e){$("."+e+" .tips").show()}function checkUsername(){var e=resetData("input-username"),t=e.charAt(0);if(0==e.length)return 1;if(e.length<3||e.length>15)return 2;var s=/^[A-Za-z]*$/;return s.test(t)?(s=/^[A-Za-z0-9_]*$/,s.test(e)?5:4):3}function checkPassword(){var e=resetData("input-password");return 0==e.length?1:e.length<6||e.length>16?2:3}function showUsernameResult(){hideNotice("username");var e=checkUsername();return 1==e?(showCheckResult("username","input-username",0,"请填写用户名"),!1):2==e?(showCheckResult("username","input-username",0,"长度应为3~15个字符"),!1):3==e?(showCheckResult("username","input-username",0,"用户名必需以英文字母开头"),!1):4==e?(showCheckResult("username","input-username",0,"用户名需由字母、数字或下划线组成"),!1):5==e?(showCheckResult("username","input-username",1,"用户名填写正确"),!0):void 0}function showPasswordResult(){hideNotice("password");var e=checkPassword();return 1==e?(showCheckResult("password","input-password",0,"请填写密码"),!1):2==e?(showCheckResult("password","input-password",0,"密码长度应为6~16个字符"),!1):3==e?(showCheckResult("password","input-password",1,"您的密码输入正确"),!0):void 0}function Advisory(){this.memberImage="",this.memberName="",this.memberGrade="",this.Question="",this.Answer="",this.advisoryTime=""}function tableChange(){var e=$(".topArea .nav-bar li"),t=$(".table li");e.on("click",function(){$(this).addClass("active").siblings("li").removeClass("active"),t.eq($(this).index()).css("display","block").siblings("li").css("display","none")})}function selectAddress(){var e={citycode:0,flag:1};getData(config.addressUrl,"get","jsonp",e,province)}function selectColor(){$(".select-color .des-item").on("click",function(){$(this).addClass("des-item-active").siblings().removeClass("des-item-active"),$(".productColor").html($(this)[0].innerHTML)})}function selectStyle(){$(".select-style .des-item").on("click",function(){$(this).addClass("des-item-active").siblings().removeClass("des-item-active"),$(".productStyle").html($(this)[0].innerHTML)})}function addProduct(){var e=0;$(".plus").on("click",function(){e=parseInt($(".product-num").val()),isNaN(e)?e=1:e<9&&e++,$(".product-num").val(e)})}function reduceProduct(){var e=0;$(".reduce").on("click",function(){e=parseInt($(".product-num").val()),isNaN(e)?e=1:e>1&&e--,$(".product-num").val(e)})}function checkProductNum(){var e=0,t=null;$(".product-num").keyup(function(){0!=(t=$(".product-num").val()).length&&((e=parseInt(t))>=1&&e<=9||$(".product-num").val(1))})}function selectProductImg(){$(".small li").length;$(".small li").mouseenter(function(){$(this).addClass("active").siblings("li").removeClass("active");var e=$(this).index()+1;$(".middle-box img").attr("src","images/middlepad"+e+".jpg"),$(".big-box img").attr("src","images/bigpad"+e+".jpg")})}function zoomProductImg(){$(".middle-box").mouseenter(function(){$(".magnifier").show(),$(".big-box").show()}),$(".middle-box").mouseleave(function(){$(".magnifier").hide(),$(".big-box").hide()}),$(".middle-box").mousemove(function(e){var t=e.pageX-$(this).offsetParent().offset().left-$(".magnifier").width()/2,s=e.pageY-$(this).offsetParent().offset().top-$(".magnifier").height()/2,a=$(".middle-box").width()-$(".magnifier").width(),i=$(".middle-box").height()-$(".magnifier").height();t<0?t=0:t>a&&(t=a),s<0?s=0:s>i&&(s=i),$(".magnifier").css({left:t+"px",top:s+"px"});var o=-t*$(".big-box img").width()/$(".middle-box").width()+"px",n=-s*$(".big-box img").height()/$(".middle-box").height()+"px";$(".big-box img").css({left:o,top:n})})}function showPage(e){var t=Math.ceil(e/config.advisoryAmount);$(".appra-num").html(e);var s=(config.advisoryStartIndex+config.advisoryAmount)/config.advisoryAmount,a="<div class='rate-page'>";a+=1==s?"<span class='page-prev'>&lt;&lt;上一页</span>":"<a href='javascript:;' class='page-prev'>&lt;&lt;上一页</a>";for(o=1;o<=t;o++)a+=o==s?"<span>"+o+"</span>":"<a href='javascript:;'>"+o+"</a>";a+=s==t?"<span class='page-next'>下一页&gt;&gt;</span>":"<a href='javascript:;' class='page-next'>下一页&gt;&gt;</a>",a+="</div>",$(".advisory-box .rate-page").remove(),$(".advisory-box").append($(a)),$(".page-prev").click(function(){"A"==this.nodeName&&(s--,config.advisoryStartIndex=config.advisoryAmount*s-config.advisoryAmount,window.scrollTo(0,1050),getAdvisory())}),$(".page-next").click(function(){"A"==this.nodeName&&(s++,config.advisoryStartIndex=config.advisoryAmount*s-config.advisoryAmount,window.scrollTo(0,1050),getAdvisory())});for(var i=$(".rate-page")[0].children,o=1;o<i.length-1;o++)$(i[o]).click(function(){"A"==this.nodeName&&(s=this.innerHTML,config.advisoryStartIndex=config.advisoryAmount*s-config.advisoryAmount,window.scrollTo(0,1050),getAdvisory())})}function getAdvisory(){var e={flag:2,startIndex:config.advisoryStartIndex,amount:config.advisoryAmount};getData(config.advisoryUrl,"get","jsonp",e,showAdvisory),e={flag:1},getData(config.advisoryUrl,"get","jsonp",e,showPage)}function intoAdvisory(){var e=localStorage.getItem("flag");localStorage.setItem("flag",0),1==e&&(window.scrollTo(0,725),$(".topArea .nav-bar li:eq(1)").addClass("active").siblings("li").removeClass("active"),$(".table li:eq(1)").eq($(this).index()).css("display","block").siblings("li").css("display","none"))}function saveProductInfo(){$(".buy").on("click",function(){var e=$(".product-num").val();localStorage.setItem("productNum",e)})}$(function(){collectionSite(),checkUserStatus(),getSearchList(),searchData(),changeNav(),gotoTop(),setProductNum(),hideDialog()});var config={addressUrl:"http://localhost/dswzServer/place.php",advisoryUrl:"http://localhost/dswzServer/advisory.php",productUrl:"http://localhost/dswzServer/product.php",taobaoUrl:"https://suggest.taobao.com/sug",baiduUrl:"http://www.baidu.com/s",registerUrl:"http://localhost/dswzServer/register.php",loginUrl:"http://localhost/dswzServer/login.php",advisoryStartIndex:0,advisoryAmount:5,productStartIndex:0,productAmount:6};Advisory.prototype={bindDOM:function(){var e="";return e+='<li class="clearfix">',e+='<div class="member-info">',e+='<div class="member-image">',e+='<img src="'+this.memberImage+'" alt="" />',e+="</div>",e+='<p class="member-name">'+this.memberName+"</p>",e+='<p class="member-grade">'+this.memberGrade+"</p>",e+="</div>",e+='<div class="shop-advisory">',e+='<div class="top clearfix">',e+='<div class="advisory-name">',e+="[商品咨询]",e+="</div>",e+='<div class="advisory-time">',e+=this.advisoryTime,e+="</div>",e+="</div>",e+='<div class="advisory-content">',e+='<div class="question">',e+=this.Question,e+="</div>",e+='<div class="answer">',e+="<span>慕课网回复：</span>"+this.Answer,e+='<div class="triangle"></div>',e+="</div>",e+="</div>",e+="</div>",e+="</li>"}},$(function(){tableChange(),selectAddress(),selectColor(),selectStyle(),addProduct(),reduceProduct(),checkProductNum(),selectProductImg(),zoomProductImg(),getAdvisory(),intoAdvisory(),saveProductInfo()});var province=function(e){setAddress("province",e),changeAddress("province")},showAdvisory=function(e){var t="";$.each(e,function(e,s){var a=new Advisory;a.memberImage=s.memberimage,a.memberName=s.membernum,a.memberGrade=s.membergrade,a.advisoryTime=s.time,a.Question=s.question,a.Answer=s.answer,t+=a.bindDOM()}),$(".advisory-list").html(t)};