function collectionSite(){$(".collection").on("click",function(){$(".cover").show()})}function checkUserStatus(){var e=localStorage.getItem("username");if(null==e||"null"==e){t="欢迎来到慕课网&nbsp;";t+='<a class="loginLink" href="login.html">[登录]</a>&nbsp;',t+='<a class="registerLink" href="register.html">[免费注册]</a>',$(".topbar .rightArea").html(t)}else{var t="欢迎";t+='<a class="showUsername" href="javascript:;">'+e+"</a>",t+="来到慕课网&nbsp;",t+='<a class="exit" href="javascript:;">[退出]</a>',$(".topbar .rightArea").html(t),$(".topbar .exit").on("click",function(){var e="欢迎来到慕课网&nbsp;";e+='<a class="loginLink" href="login.html">[登录]</a>&nbsp;',e+='<a class="registerLink" href="register.html">[免费注册]</a>',$(".topbar .rightArea").html(e),localStorage.setItem("username",null)})}}function getSearchList(){$(".search-box").mouseleave(function(){$(".search-box ul").remove()}),$(".search-text").keyup(function(){$(".search-box ul").remove();var e={code:"utf-8",q:$(".search-text").val(),_ksTS:"1490839958568_2749",jsonpCallback:"jsonp2750",area:"b2c",k:1,bucketid:7,src:"tmall_pc"};getData(config.taobaoUrl,"get","jsonp",e,getSearchResult)})}function getSearchResult(e){var t=e.result;showSearchList(t,$(".search-text").val()),selectResult(t)}function showSearchList(e,t){if(!(e.length<=0)){var n="<ul class='result-list'>";$.each(e,function(e,s){if(n+="<li class='clearfix' value="+e+">",-1==(e=s[0].indexOf(t)))n+="<p class='proName'>"+s[0]+"</p>";else if(0==e)n+="<p class='proName'><em>"+t+"</em>"+s[0].substring(t.length)+"</p>";else if(e==s[0].length-t.length)n+="<p class='proName'>"+s[0].substring(0,s[0].length-t.length)+"<em>"+t+"</em></p>";else{var o=s[0].split(t);n+="<p class='proName'>";for(var i=0;i<o.length-1;i++)n+=o[i],n+="<em>"+t+"</em>";n+=o[o.length-1],n+="</p>"}n+="<p class='resultNum'>约"+s[1]+"个商品</p>",n+="</li>"}),n+="</ul>",$(".search-box").append(n)}}function selectResult(e){var t=$(".result-list li");$.each(t,function(t,n){n.onclick=function(){var t=$(this).attr("value");$(".search-box ul").remove(),$(".search-text").val(e[t][0])}})}function searchData(){$(".search-btn").click(function(){var e=$(".search-text ").val();window.location=config.baiduUrl+"?wd="+e})}function changeNav(){var e=$(".nav li");$.each(e,function(e,t){$(t).click(function(){$(this).addClass("active").siblings("li").removeClass("active"),localStorage.setItem("active",$(this).index())})})}function gotoTop(){$("goTop");var e=0,t=0,n=null;$(window).scroll(function(){$(document).scrollTop()>0?$("#goTop").show():$("#goTop").hide(),e=$(document).scrollTop()}),$("#goTop").on("click",function(){clearInterval(n),t=0,n=setInterval(function(){e+=(t-e)/10,window.scrollTo(0,e),e==t&&clearInterval(n)},10)})}function setProductNum(){var e=parseInt(localStorage.getItem("productNum"));isNaN(e)&&(e=1),$(".shopCar .shopNum").text(e)}function hideDialog(){$(".hide-dialog").on("click",function(){$(".cover").hide()})}function setBanner(){function e(){s=++s>n.length-1?0:s,t.removeClass("current"),t.eq(s).addClass("current"),n.removeClass("active");var e=n.eq(s);e.addClass("active"),e.css("opacity","0"),animate(e[0],{opacity:100},40)}var t=$(".circle-list li"),n=$(".banner-list li"),s=0,o=null;t.on("click",function(){if($(this).index()!=s){s=$(this).index(),$(this).addClass("current").siblings("li").removeClass("current"),n.removeClass("active");var e=n.eq(s);e.addClass("active"),e.css("opacity","0"),animate(e[0],{opacity:100},40)}}),o=setInterval(e,3e3),$(".banner-list").mouseenter(function(){clearInterval(o)}),$(".banner-list").mouseleave(function(){o=setInterval(e,3e3)})}function getData(e,t,n,s,o){$.ajax({url:e,type:t,dataType:n,data:s,success:o})}function setAddress(e,t,n,s){$("#"+e+" .select-options").children("li").remove(),$.each(t,function(t,n){var s=$("<li></li>").html(n.name).attr("value",n.code);$("#"+e+" .select-options").append(s)});var o=$("#"+e+" .select-options").children("li:eq(0)").attr("value"),i=$("#"+e+" .select-options").children("li:eq(0)")[0].innerHTML;if($("#"+e+" .select-name").html(i),null!=n){var c={citycode:o,flag:n};getData(config.addressUrl,"get","jsonp",c,s)}}function changeAddress(e,t,n){$("#"+e).mouseenter(function(){$("#"+e+" .select-options").show()}),$("#"+e).mouseleave(function(){$("#"+e+"  .select-options").hide()}),$("#"+e+" .select-options li").click(function(){$("#"+e+" .select-name").html($(this)[0].innerHTML),$("#"+e+" .select-options").hide();$(this).attr("value");if(null!=t){var s={citycode:$(this).attr("value"),flag:t};getData(config.addressUrl,"get","jsonp",s,n)}})}function setOverflowY(e){var t=$("#"+e+" .select-options"),n=$("#"+e+" .select-options li");t.height()<122?(t.css("overflow-y","inherit"),n.css("width","100%")):(t.css("overflow-y","scroll"),n.css("width","93px"))}function createPage(e,t,n,s,o){var i=Math.ceil(e/t);$(".appra-num").html(e);var c=(n+t)/t,a="<div class='rate-page'>";a+=1==c?"<span class='page-prev'>&lt;&lt;上一页</span>":"<a href='javascript:;' class='page-prev'>&lt;&lt;上一页</a>";for(l=1;l<=i;l++)a+=l==c?"<span>"+l+"</span>":"<a href='javascript:;'>"+l+"</a>";a+=c==i?"<span class='page-next'>下一页&gt;&gt;</span>":"<a href='javascript:;' class='page-next'>下一页&gt;&gt;</a>",a+="</div>",$("."+s+" .rate-page").remove(),$("."+s).append($(a)),$(".page-prev").click(function(){if("A"==this.nodeName){var e={flag:2,startIndex:n=t*--c-t,amount:t};getData(config.productUrl,"get","jsonp",e,o)}}),$(".page-next").click(function(){if("A"==this.nodeName){var e={flag:2,startIndex:n=t*++c-t,amount:t};getData(config.productUrl,"get","jsonp",e,o),e={flag:1},getData(config.productUrl,"get","jsonp",e,createPage)}});for(var r=$(".rate-page")[0].children,l=1;l<r.length-1;l++)$(r[l]).click(function(){if("A"==this.nodeName){c=this.innerHTML;var e={flag:2,startIndex:n=t*c-t,amount:t};getData(config.productUrl,"get","jsonp",e,o)}})}function resetData(e){var t=$("."+e).val();return t=Tools.removeAll(t),$("."+e).val(t),t}function showCheckResult(e,t,n,s){0==n?($("."+e+" .notice-info").css("display","inline-block"),t.length>0&&$("."+e+" ."+t).css("border-color","#e22"),$("."+e+" .notice-content").css("color","#e22"),$("."+e+" .notice-icon").css({"background-position":"-17px -100px"})):1==n&&($("."+e+" .notice-info").css("display","inline-block"),$("."+e+" .notice-content").css("color","#3D882D"),$("."+e+" .notice-icon").css({"background-position":"0px -117px"})),$("."+e+" .notice-content")[0].innerHTML=s}function hideCheckResult(e,t){$("."+e+" .notice-info").css("display","none"),t.length>0&&$("."+e+" ."+t).css("border-color","#C2C2C2")}function hideNotice(e){$("."+e+" .tips").hide()}function showNotice(e){$("."+e+" .tips").show()}function checkUsername(){var e=resetData("input-username"),t=e.charAt(0);if(0==e.length)return 1;if(e.length<3||e.length>15)return 2;var n=/^[A-Za-z]*$/;return n.test(t)?(n=/^[A-Za-z0-9_]*$/,n.test(e)?5:4):3}function checkPassword(){var e=resetData("input-password");return 0==e.length?1:e.length<6||e.length>16?2:3}function showUsernameResult(){hideNotice("username");var e=checkUsername();return 1==e?(showCheckResult("username","input-username",0,"请填写用户名"),!1):2==e?(showCheckResult("username","input-username",0,"长度应为3~15个字符"),!1):3==e?(showCheckResult("username","input-username",0,"用户名必需以英文字母开头"),!1):4==e?(showCheckResult("username","input-username",0,"用户名需由字母、数字或下划线组成"),!1):5==e?(showCheckResult("username","input-username",1,"用户名填写正确"),!0):void 0}function showPasswordResult(){hideNotice("password");var e=checkPassword();return 1==e?(showCheckResult("password","input-password",0,"请填写密码"),!1):2==e?(showCheckResult("password","input-password",0,"密码长度应为6~16个字符"),!1):3==e?(showCheckResult("password","input-password",1,"您的密码输入正确"),!0):void 0}function selectAddress(){var e={citycode:0,flag:1};getData(config.addressUrl,"get","jsonp",e,province)}function submitDeliveryInfo(){var e=0;$(".button-submit").on("click",function(t){if(t.stopPropagation(),$(".place .notice-info").css("display","inline-block"),0!=(e=checkAddress()))if(1!=e)if(showCheckResult("address","input-address",1,""),0!=(e=checkReceiver()))if(1!=e)if(showCheckResult("receiver","input-receiver",1,""),0!=(e=checkPhoneNum()))if(1!=e){if(showCheckResult("phone","input-phone",1,""),1==(e=checkNumber()))return showCheckResult("tel-phone","input-area",0,"区号或电话号码格式不正确"),showCheckResult("tel-phone","input-tel",0,"区号或电话号码格式不正确"),void showCheckResult("tel-phone","input-extension",0,"区号或电话号码格式不正确");2==e&&(showCheckResult("tel-phone","input-area",1,""),showCheckResult("tel-phone","input-tel",1,""),showCheckResult("tel-phone","input-extension",1,""));var n=$("#province .select-name")[0].innerHTML,s=$("#city .select-name")[0].innerHTML,o=$("#area .select-name")[0].innerHTML,i=$(".input-address").val(),c=$(".input-receiver").val(),a=$(".input-phone").val(),r=$(".input-area").val(),l=$(".input-tel").val(),u=$(".input-extension").val();$(".receive-info .show-result").fadeIn(),$(".receive-info .show-result").fadeOut(3e3);var h={province:n,city:s,area:o,address:i,receiver:c,phoneNum:a,areaNum:r,telNum:l,extensionNum:u};localStorage.setItem("deliveryInfo",JSON.stringify(h))}else showCheckResult("phone","input-phone",0,"请填写正确的手机号码");else showCheckResult("phone","input-phone",0,"请填写您的手机号码");else showCheckResult("receiver","input-receiver",0,"长度应为2~10个字符");else showCheckResult("receiver","input-receiver",0,"请填写收货人的姓名");else showCheckResult("address","input-address",0,"长度应为4~26个字符");else showCheckResult("address","input-address",0,"请填写详细的收货地址")})}function checkAddress(){var e=resetData("input-address");return 0==e.length?0:e.length<4||e.length>26?1:2}function checkReceiver(){var e=resetData("input-receiver");return 0==e.length?0:e.length<2||e.length>10?1:2}function checkPhoneNum(){var e=resetData("input-phone");return 0==e.length?0:/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(e)?2:1}function checkNumber(){var e=resetData("input-area"),t=resetData("input-tel"),n=resetData("input-extension");return 0==e.length&&0==t.length&&0==n.length?3:e.length>=3&&!isNaN(e)&&t.length>=5&&!isNaN(t)&&0==n.length?2:e.length>=3&&!isNaN(e)&&t.length>=5&&!isNaN(t)&&n.length>0&&!isNaN(n)?2:1}function recoverStatus(){$(document).on("click",function(){2!=checkAddress()&&hideCheckResult("address","input-address"),2!=checkReceiver()&&hideCheckResult("receiver","input-receiver"),2!=checkPhoneNum()&&hideCheckResult("phone","input-phone"),2!=checkNumber()&&(hideCheckResult("tel-phone","input-area"),hideCheckResult("tel-phone","input-tel"),hideCheckResult("tel-phone","input-extension"))}),$(".receive-content input").on("click",function(){var e=$(this).attr("data-class");void 0!=e&&($("."+e+" .tips").show(),$("."+e+" .notice-info").hide())})}function setInvoiceInfo(){selectInvoiceInfo("invoice-type"),selectInvoiceInfo("invoice-header"),saveInvoiceInfo(),cancelInvoiceInfo()}function selectInvoiceInfo(e){setOverflowY(e),$("#"+e).on("mouseenter",function(){$("#"+e+" .select-options").show()}),$("#"+e).on("mouseleave",function(){$("#"+e+" .select-options").hide()}),$("#"+e+" li").on("click",function(){$("#"+e+" .select-name")[0].innerHTML=this.innerHTML})}function saveInvoiceInfo(){$(".invoice-content .save").on("click",function(){getInvoiceInfo(),$(".invoice-info .show-result").fadeIn(),$(".invoice-info .show-result").fadeOut(3e3)})}function cancelInvoiceInfo(){$(".invoice-content .cancel").on("click",function(){$("#use-invoice").attr("checked",!1);var e=$("#invoice-type li:eq(0)").html();$("#invoice-type .select-name").html(e);var t=$("#invoice-header li:eq(0)").html();$("#invoice-header .select-name").html(t);$(".invoice-name").val("");getInvoiceInfo()})}function getInvoiceInfo(){var e={flag:$("#use-invoice").is(":checked"),invoiceType:$("#invoice-type .select-name").html(),invoiceHeader:$("#invoice-header .select-name").html(),invoiceName:$(".invoice-name").val()};localStorage.setItem("invoiceInfo",JSON.stringify(e))}function commitOrder(){$(".order-content .commit").on("click",function(){$(".delivery-info .show-result").fadeIn(),$(".delivery-info .show-result").fadeOut(3e3)})}function setProductInfo(){var e=parseInt(localStorage.getItem("productNum"));isNaN(e)&&(e=1);var t=1999*e;$("#productNum").text(e),$("#totalPrice").text(t+".00"),$(".total em").text("￥"+t+".00")}$(function(){collectionSite(),checkUserStatus(),getSearchList(),searchData(),changeNav(),gotoTop(),setProductNum(),hideDialog()});var config={addressUrl:"http://localhost/dswzServer/place.php",advisoryUrl:"http://localhost/dswzServer/advisory.php",productUrl:"http://localhost/dswzServer/product.php",taobaoUrl:"https://suggest.taobao.com/sug",baiduUrl:"http://www.baidu.com/s",registerUrl:"http://localhost/dswzServer/register.php",loginUrl:"http://localhost/dswzServer/login.php",advisoryStartIndex:0,advisoryAmount:5,productStartIndex:0,productAmount:6},Tools={removeAll:function(e){return e.replace(/\s+/g,"")}};$(function(){selectAddress(),setProductInfo(),submitDeliveryInfo(),recoverStatus(),setInvoiceInfo(),commitOrder()});var area=function(e){setAddress("area",e),setOverflowY("area"),changeAddress("area")},city=function(e){setAddress("city",e,3,area),setOverflowY("city"),changeAddress("city",3,area)},province=function(e){setAddress("province",e,2,city),setOverflowY("city"),changeAddress("province",2,city)};